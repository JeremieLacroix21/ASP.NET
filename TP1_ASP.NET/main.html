<!DOCTYPE html>
<!--Liste d'objects de classe Contact
- Mise en forme de l'interface en trois sections exploitant le style display:grid et grid-template-columns
- Le formulaire apparaît suite au clic sur + ou sur le bouton de modification d'un contact
- Le survol des boutons fait apparaître une infobulle
- Le retrait doit être confirmé via un dialogue
- La liste des contacts est déroulante
- Utilisation de la classe ValidationProvider pour le formulaire
- Une fonction de validation pour chacun des champs:
       - Nom : non vide, seulement des caractères alphabétiques
       - Téléphone : non vide, masque de saisie avec jQuery (bonus)
       - Email : non vide, syntaxe vérifiée par regex (bonus)
- Pour la surbrillance de la rangée de contact survolée :
       - Chacune des cellules devront être construites par programmation et posséder la classe CSS cell et row_x (x étant le numéro de la rangée)
       - Chacune des cellules devront réagir au mouseover et mouseleave afin de mettre à jour la couleur de fond
       - Les boutons de modification et retrait devront être construits par programmation et doivent apparaître lors d'un survol de leur rangée-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta author="Charles Bourgeois et Jérémie Lacroix">
    <meta http-equiv="Content-Type" content="text/html; charset= ISO-8859-1">
    <title>TP 1 Web</title>
    <!-- Fichier local qui contient la librairie jQuery -->
    <script src="js/jquery-3.3.1.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- Style pour les infobulles -->
    <link rel="stylesheet" href="css/tooltip.css">
    <!-- Style pour l'interface et la liste des contacts -->
    <link rel="stylesheet" href="css/stylesheet.css">
    <!-- Fichier local qui contient la librairie de Validation -->
    <script src="js/Validation.js"></script>
    <!-- Fichier local qui contient les fonctions de requÃªte au service Web API -->
    <script src="js/contactManagerWebAPIRequest.js"></script>
    <!-- pour la dialogue de confirmation de retrait d'un contact -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
    <script src="js/jquery.maskedinput.js"></script>
    <!-- lien vers le favicon gÃ©nÃ©rÃ© par https://favicon.io/favicon-converter/-->
    <link rel="icon" href="favicon.ico">
    <link rel="manifest" href="site.webmanifest">
</head>
<body>
    <!-- Liste de contact -->
    <div class="container">
        <h3 style="color :black"> <img src="favicon.jpeg"> &nbsp; Gestionaire des contacts</h3> 
        <div class="blackbordure">
            <div class="main-header">
                <div class="main-contact">
                    <div>Nom</div>
                    <div>Téléphone</div>
                    <div>Courriel</div>
                    <div>
                        <button id="barreAjout" tooltip="Ajouter un contact" tooltip-position="left">
                            <span class="glyphicon glyphicon-plus"></span> 
                        </button>
                    </div>
                    <div>&nbsp;</div>
                </div>
            </div>
            <div class="main-container">
                <div class="main-contact-container" id="contactContainer">
                    <div>
                        <input type="hidden" id="" />
                        <input type="text" id="Name" placeholder="Nom" class="form-control" />
                    </div>
                    <div>
                        <input type="text" id="Phone" placeholder="Téléphone" class="phone form-control" />
                    </div>
                    <div>
                        <input type="text" id="Email" placeholder="Courriel" class="form-control" />
                    </div>
                    <div>
                        <button id="ajoutContact" tooltip="Ajouter" tooltip-position="left">
                            <span class="glyphicon glyphicon glyphicon-ok"></span>
                        </button>
                        <button id="modifierContact" tooltip="Modifier" tooltip-position="left">
                            <span class="glyphicon glyphicon-pencil"></span>
                        </button>
                    </div>
                    <div>
                        <button id="cancel" tooltip="Annuler" tooltip-position="left">
                            <span class="glyphicon glyphicon-repeat"></span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="main-list">
                <div class="main-contact-list" id="">
                <!-- faites par id-->
                </div>
            </div>
        </div>
    </div>
        <!-- Fonctions -->
        <script>
            "use strict";
            $(document).ready(initUI);

            let modifier = false;
            let ajouter = false;
            let validationProvider;

            function initUI() {
                initvalidation();
                eraseControl();
                //clic boutons 
                $('#ajoutContact').click(ajoutContact);
                $('#barreAjout').click(barreAjout);
                $('#modifierContact').click(modifierContact);
                $('#cancel').click(eraseControl);
                $('#Name').keypress(textInputAlphaFilter);
                //message d'attente
                MessageDattente();
                getContacts();
            }

            function MessageDattente() {
                $('#contactList').empty()
                $('#contactList').append(makeCell("En attente de réponse du service Web...", "waiting"));
                $('#contactList').append($('<img src="images/Loading_icon.gif" alt="waiting"/>'));
            }
            //validation provider 
            function initValidation() {
                $(".phone").mask("(999) 999-9999");
                validationProvider = new ValidationProvider();
                validationProvider.addControl("Name", validate_Name);
                validationProvider.addControl("Phone", validate_Phone);
                validationProvider.addControl("Email", validate_email);
            }
            function resetValidation() {
                validationProvider.reset();
            }
            function validate_Name() {
                let TBX_FirstName = document.getElementById("Name");

                if (TBX_FirstName.value === "")
                    return "Nom manquant";

                return "";
            }
            function validate_Phone() {
                let TBX_LastName = document.getElementById("Phone");

                if (TBX_LastName.value === "")
                    return "TÃ©lÃ©phone manquant";

                return "";
            }
            function validate_email() {
                let TBX_Email = document.getElementById("Email");
                let emailRegex = /^([\w\.\-]+)@([\w\-]+)((\.(\w){2,3})+)$/;

                if (TBX_Email.value === "")
                    return "Adresse de courriel manquante";

                if (!emailRegex.test(TBX_Email.value))
                    return "Adresse de courriel invalide";

                return "";
            }
            //fin du validation provider
            //début du erasecontrol
            function eraseControl() {
                ajouter = false;
                modifier = false;
                resetValidation();

                // rÃ©tablir la couleur de fond de toutes les rangÃ©es
                $('.cell').removeClass('selectedRow');

                // masquer le formulaire de saisie/modification de contact
                $('#contactContainer').hide();

                // RÃ©tablir la visibilitÃ© par dÃ©faut des boutons
                $('#ajoutContact').show();
                $('#modifierContact').hide();
                $('#barreAjout').show();

                // Effacer les champs du formulaire
                $('#Name').val('');
                $('#Phone').val('');
                $('#Email').val('');

                // Masquer tous les boutons des rangÃ©es de contact
                $('#contactList button').hide();
            }
            //fin du erasecontrol
            // Requète au service web API: Liste des contacts
            function getContacts() {
                webAPI_getContacts(updateContactList, insertErrorStatus);
            }
            // Afficher le formulaire pour la saisie de contact
            function showAddContact() {
                addMode = true;
                $('#contactContainer').show();
                $('#barreAjout').hide();
            }
        </script>
</body>

</html>